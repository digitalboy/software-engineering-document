好的，这是一份关于问题关系（边）设计的指南文档：

## 问题关系（边）设计指南

**1. 引言**

在问题链中，问题关系（边）定义了问题节点之间的连接方式和触发条件，是构建问题链结构的关键要素。 设计良好的问题关系，可以有效地引导用户逐步探索和明确目标信息。 本指南旨在帮助你设计出通用、灵活、易于理解的问题关系，以构建高质量的问题链。

**2. 核心原则**

*   **清晰性：** 问题关系的类型和含义应该清晰易懂，避免产生歧义。
*   **简洁性：** 尽量使用最少的边类型来表达问题之间的关系。
*   **通用性：** 设计的边类型应该适用于各种场景和领域。
*   **灵活性：** 边应该能够支持多种触发条件，以适应不同的用户回答。
*   **可扩展性：** 应该预留扩展空间，以便未来可以添加新的边类型。

**3. 核心边类型**

在问题链中，我们主要使用以下三种核心边类型：

*   **`followUp` (后续问题):**
    *   **定义：** 表示在起始问题之后提出的问题。
    *   **适用场景：** 用于连接问题链中的主要流程，引导用户逐步深入地探索问题。
    *   **触发条件：** 可以无条件触发 (即在回答完起始问题后立即提出)，也可以根据特定条件触发。
    *   **示例：**
        *   问题 A (您希望通过这个产品/功能解决什么核心问题？)  ->  `followUp`  -> 问题 B (您的目标用户是谁？ 他们有什么痛点？)
*   **`conditional` (条件问题):**
    *   **定义：** 表示根据特定条件触发的问题。
    *   **适用场景：** 用于处理分支逻辑，根据用户的回答，提出不同的问题。
    *   **触发条件：** 必须根据特定条件触发。
    *   **示例：**
        *   问题 C (您希望是按照消费金额累计，还是按照购买的商品种类累计？)
            *   如果用户回答 "消费金额"，则  `conditional`  -> 问题 D1 (具体是消费多少金额累计多少积分呢？)
            *   如果用户回答 "商品种类"，则  `conditional`  -> 问题 D2 (具体是购买哪些商品可以累计积分呢？)
*   **`intentBasedFollowUp` (基于意图的后续问题):**
    *   **定义：** 表示根据用户意图触发的问题。
    *   **适用场景：** 用于根据用户的意图，智能地推荐相关的问题。
    *   **触发条件：** 必须根据用户意图触发。
    *   **示例：**
        *   问题 E (您对 App 的界面设计有什么要求吗？)
            *   如果系统识别出用户表达了 "简洁" 的意图，则  `intentBasedFollowUp`  -> 问题 F (您希望 App 使用哪种颜色主题？)

**4. 触发条件设计**

触发条件定义了在什么情况下触发边指向的目标问题。 我们使用以下结构来定义触发条件：

```typescript
triggerCondition?: {
  type: "intent" | "condition" | "and" | "or";
  intent?: string; // 用于定义意图，当用户输入的内容与此意图匹配时，触发该条件。 仅当 type 为 "intent" 时有效。
  conditions?: { //当 type 为 "and" 或者 "or" 时， 嵌套的 triggerCondition
    type: "intent" | "condition" | "and" | "or";
    intent?: string;
    condition?: {
        type: "equals" | "contains" | "notContains" | "startsWith" | "endsWith";
        value: string | string[] | boolean | number;
        questionId: string;
      };
  }[];
  condition?: { //用于根据问题的答案进行条件判断。 仅当 type 为 "condition" 时有效。
    type: "equals" | "contains" | "notContains" | "startsWith" | "endsWith";
    value: string | string[] | boolean | number;
    questionId: string;
  };
} | null;
```

*   **`type`：** 触发条件类型。
    *   `intent`： 意图匹配。 当用户输入的内容与指定的意图匹配时，触发该条件。
    *   `condition`： 条件判断。 根据问题的答案进行条件判断。
    *   `and`： 且。 多个条件同时满足时，触发该条件。
    *   `or`： 或。 多个条件中任意一个满足时，触发该条件。
*   **`intent`：** 用于定义意图，当用户输入的内容与此意图匹配时，触发该条件。 仅当 `type` 为 `intent` 时有效。
*   **`condition`：** 用于根据问题的答案进行条件判断。 仅当 `type` 为 `condition` 时有效。 包含以下属性：
    *   `type`： 条件类型。
        *   `equals`： 等于。
        *   `contains`： 包含。
        *   `notContains`： 不包含。
        *   `startsWith`： 以指定字符串开头。
        *   `endsWith`： 以指定字符串结尾。
    *   `value`： 条件值。 用于与问题的答案进行比较。 类型需要与问题的 `answerType` 一致。
    *   `questionId`： 用于判断条件的问题的 `questionId`。

**5. 设计步骤**

1.  **确定问题链的起始问题。**
2.  **分析起始问题可能产生的回答。**
3.  **根据不同的回答，设计后续问题。**
4.  **使用 `followUp`、`conditional` 和 `intentBasedFollowUp` 连接问题。**
5.  **根据需要，为 `conditional` 和 `intentBasedFollowUp` 配置 `triggerCondition`。**
6.  **重复步骤 3-5，直到问题链覆盖所有可能的场景。**
7.  **检查问题链是否存在循环引用或死循环。**
8.  **测试问题链的可用性和有效性。**

**6. 最佳实践**

*   **尽量保持问题简洁明了。**
*   **避免使用过于复杂的问题关系。**
*   **为每个问题关系添加描述信息。**
*   **定期审查和更新问题链。**

**7. 总结**

问题关系是构建高质量问题链的关键。 通过遵循本指南，你可以设计出清晰、简洁、通用、灵活和可扩展的问题关系，从而构建出强大的问题链，有效地引导用户探索和明确目标信息。